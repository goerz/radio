# Streaming Radio Terminal Client

This package wraps your favorite terminal based audio stream player (like `mpg123`). It provides a RESTful API to control stream selection and playback. Includes a simple text based UI to select stations; banners autogenerated with `pyfiglet`:

     _____                     _ _              _____
    |  ___|_ ___   _____  _ __(_) |_ ___  ___  |_   _|   _ _ __   ___ _ __
    | |_ / _` \ \ / / _ \| '__| | __/ _ \/ __|   | || | | | '_ \ / _ \ '__|
    |  _| (_| |\ V / (_) | |  | | ||  __/\__ \   | || |_| | | | |  __/ |
    |_|  \__,_| \_/ \___/|_|  |_|\__\___||___/   |_| \__,_|_| |_|\___|_|


     .oooooo..o                                       oooooooooooo ooo        ooooo    ooooooooooooo
    d8P'    `Y8                                       `888'     `8 `88.       .888'    8'   888   `8
    Y88bo.       .ooooo.  ooo. .oo.  .oo.    .oooo.    888          888b     d'888          888      oooo  oooo  ooo. .oo.    .ooooo.  oooo d8b
     `"Y8888o.  d88' `88b `888P"Y88bP"Y88b  `P  )88b   888oooo8     8 Y88. .P  888          888      `888  `888  `888P"Y88b  d88' `88b `888""8P
         `"Y88b 888   888  888   888   888   .oP"888   888    "     8  `888'   888          888       888   888   888   888  888ooo888  888
    oo     .d8P 888   888  888   888   888  d8(  888   888          8    Y     888          888       888   888   888   888  888    .o  888
    8""88888P'  `Y8bod8P' o888o o888o o888o `Y888""8o o888o        o8o        o888o        o888o      `V88V"V8P' o888o o888o `Y8bod8P' d888b


(if you don't like this, you can turn it off)

No more Flash or awkward browser windows consuming memory in order to pipe in your jams. `tty_radio` supports manual entries you want to import as well as auto-generated entries from SomaFM.

Also serves a web UI at http://localhost:7887, for remote management.


## Install

* Verify you have `mpg123`
    * else change `stream.mpg123.subp_cmd` to your fav player
    * Whatever you choose must not buffer output
    * For OS X, Homebrew: `brew install mpg123`
    * For Linux, apt: `sudo apt-get install mpg123`
* Optionally, if you want to display album art
    * `pip install pillow`
* Optionally, if you want to scrobble artists and song titles to Last.fm
    * `pip install pylast`
* `pip install git+git://github.com/goerz/radio.git@master#egg=tty_radio`
    * This adds `radio` to your path

## Usage

* `radio` starts the server and terminal UI interface
* `radio server` starts the server only
* `radio play`, `radio stop`, `radio toggle`, ... to control a running server from the command line ("scripting interface"). See `radio --help` for details.
* Defaults to a list of favorite channels
    * Auto-generated from a hardcoded value
    * Edit `~/.tty_radio-favs.csv` to add/remove
    * Any changes are permanent (it's not auto updated)
* Select the station to listen to by typing its number (left column) and pressing Enter
* There are other views:
    * At the bottom of the list is a SomaFM view
        * Auto-generated from web scraping updated if more than 7 days old
        * Edit `~/.tty_radio-soma.csv` to add/remove, but you will loose changes on next update
    * The Di.FM view has been removed since they've blocked direct streaming


## Config file

`radio` reads settings from a config file in `~/.tty_radio-settings.ini`. The file is automatically created if it does not exist. See `radio config --help` for details.


## Scrobbling to Last.fm

You can set up automatic scrobbling of author/title information from the radio stream metadata. This requires that you have the `pylast` Python package installed.

Next, register at https://www.last.fm/api/account/create to obtain an API key and "shared secret". Enter this information along with your account credentials in the config file, e.g.:

    [Lastfm]
    api key = 01592035c169e98daf1ecffb783de3ad
    shared secret = be09b8b842e7b2dab0df1afc8dff1833
    username = lastfmuser8
    password hash = 1060b7b46a3bd36b3a0d66e0127d0517

The "password hash" is an MD5-hash of your account password. You may obtain it in Python:

    >>> import pylast
    >>> pylast.md5("your_password")
    '1060b7b46a3bd36b3a0d66e0127d0517'

Lastly, activate scrobbling in the `Server` section of the config file:

    [Server]
    scrobble = yes
    notify_logfile = ~/.tty_radio-scrobble.log

The `notify_logfile` is optional, and may be useful for debugging.
